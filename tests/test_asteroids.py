import os

import pytest

from aoc.day_10 import Raycaster


TEST_33 = (
    "......#.#.\n"
    "#..#.#....\n"
    "..#######.\n"
    ".#.#.###..\n"
    ".#..#.....\n"
    "..#....#.#\n"
    "#..#....#.\n"
    ".##.#..###\n"
    "##...#..#.\n"
    ".#....####\n"
)

TEST_35 = (
    "#.#...#.#.\n"
    ".###....#.\n"
    ".#....#...\n"
    "##.#.#.#.#\n"
    "....#.#.#.\n"
    ".##..###.#\n"
    "..#...##..\n"
    "..##....##\n"
    "......#...\n"
    ".####.###.\n"
)

TEST_41 = (
    ".#..#..###\n"
    "####.###.#\n"
    "....###.#.\n"
    "..###.##.#\n"
    "##.##.#.#.\n"
    "....###..#\n"
    "..#.#..#.#\n"
    "#..#.#.###\n"
    ".##...##.#\n"
    ".....#.#..\n"
)

TEST_210 = (
    ".#..##.###...#######\n"
    "##.############..##.\n"
    ".#.######.########.#\n"
    ".###.#######.####.#.\n"
    "#####.##.#.##.###.##\n"
    "..#####..#.#########\n"
    "####################\n"
    "#.####....###.#.#.##\n"
    "##.#################\n"
    "#####.##.###..####..\n"
    "..######..##.#######\n"
    "####.##.####...##..#\n"
    ".#####..#.######.###\n"
    "##...#.##########...\n"
    "#.##########.#######\n"
    ".####.#.###.###.#.##\n"
    "....##.##.###..#####\n"
    ".#.#.###########.###\n"
    "#.#.#.#####.####.###\n"
    "###.##.####.##.#..##\n"
)


@pytest.mark.parametrize(
    ("data", "answer"),
    [
        (".#..#\n.....\n#####\n....#\n...##", 8),
        (TEST_33, 33),
        (TEST_35, 35),
        (TEST_41, 41),
        (TEST_210, 210),
    ]
)
def test_raytracer(data, answer):
    if answer > 100 and os.getenv("PYTEST_FILTER") == "SHORT":
        pytest.skip("skipping longer tests")
    assert Raycaster.from_str(data).best_view() == answer
